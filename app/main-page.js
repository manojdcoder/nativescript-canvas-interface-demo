"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform_1 = require("platform");
var observableModule = require("data/observable");
var _ = require('lodash');
var nsCanvasInterfaceModule = require('nativescript-canvas-interface');
var oNSCanvasInterface;
var imageView;
var page;
/**
 * Function to be executed on Page Load.
 */
function pageLoaded(args) {
    page = args.object;
    var webView = page.getViewById('webView');
    imageView = page.getViewById('img');
    initCanvasInterface(webView);
    setBindingContext();
}
exports.pageLoaded = pageLoaded;
/**
 * Initializes canvas interface plugin and sets image to canvas, once webview is loaded.
 */
function initCanvasInterface(webView) {
    oNSCanvasInterface = new nsCanvasInterfaceModule.NativescriptCanvasInterface(webView, 'canvasEle');
    webView.on('loadFinished', function (args) {
        if (!args.error) {
            var width = platform_1.screen.mainScreen.widthDIPs;
            var aspectRatio = imageView.imageSource.width / imageView.imageSource.height;
            var height = width / aspectRatio;
            oNSCanvasInterface.setImage('setCanvasImage', imageView.imageSource, [{ width: width, height: height }]);
        }
    });
}
/**
 * Sets Page binding context for two way data binding.
 */
function setBindingContext() {
    var context = new observableModule.Observable();
    context.set('brightness', 0);
    // Adjusting image brightness, once the brightness slider position is changed.
    context.on('propertyChange', _.debounce(function (data) {
        var brightnessValue = data.object.get('brightness');
        setBrightness(brightnessValue);
    }, 100));
    page.bindingContext = context;
}
/**
 * Performs image manipulation on canvas in webview, and renders the returned image in Image element.
 */
function performCanvasMainpulation(fnName, args) {
    imageView.animate({
        opacity: 0.5,
        duration: 150
    });
    oNSCanvasInterface.createImage(fnName, args).then(function (result) {
        imageView.imageSource = result.image;
        imageView.animate({
            opacity: 1,
            duration: 150
        });
    }, function (error) {
        console.log('error', error);
    });
}
/**
 * Adjusts brighness of the image.
 */
function setBrightness(value) {
    performCanvasMainpulation('setBrightness', [value]);
}
/**
 * Resets brightness on reset image operation.
 */
function resetBrightness() {
    page.bindingContext.set('brightness', 0);
}
/**
 * Applies preset selected by user to the image.
 */
function setPreset(args) {
    var presetId = args.object.id;
    resetBrightness();
    performCanvasMainpulation('setPreset', [presetId]);
}
exports.setPreset = setPreset;
/**
 * Resets image to the its initial state.
 */
function resetImage() {
    resetBrightness();
    performCanvasMainpulation('resetImage');
}
exports.resetImage = resetImage;
// TODO: Add provision to download the edited image
// export function downloadImage(){
//     var gallaryPath;
//     if(android){
//         gallaryPath = path.join(android.os.Environment.getExternalStorageDirectory()+'', ''+android.os.Environment.DIRECTORY_PICTURES, 'demo.png');
//         console.log('gallary path is1 ', gallaryPath);
//         var folder = knownFolders.documents();
//         var fullPath = path.join(folder.path, "Test.png");
//         try{
//             imageView.imageSource.saveToFile(fullPath, ImageFormat.png);    
//         }catch(e){
//             console.log('error is === ', e);
//         }   
//     }
// }
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EscUNBQWtDO0FBQ2xDLGtEQUFxRDtBQUVyRCxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUIsSUFBSSx1QkFBdUIsR0FBRyxPQUFPLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUN2RSxJQUFJLGtCQUFrQixDQUFDO0FBQ3ZCLElBQUksU0FBZ0IsQ0FBQztBQUNyQixJQUFJLElBQUksQ0FBQztBQUVUOztHQUVHO0FBQ0gsb0JBQTJCLElBQUk7SUFDM0IsSUFBSSxHQUFTLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDekIsSUFBSSxPQUFPLEdBQVksSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNuRCxTQUFTLEdBQVUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMzQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixpQkFBaUIsRUFBRSxDQUFDO0FBQ3hCLENBQUM7QUFORCxnQ0FNQztBQUVEOztHQUVHO0FBQ0gsNkJBQTZCLE9BQWdCO0lBQ3pDLGtCQUFrQixHQUFHLElBQUksdUJBQXVCLENBQUMsMkJBQTJCLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ25HLE9BQU8sQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLFVBQUMsSUFBSTtRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2QsSUFBSSxLQUFLLEdBQUcsaUJBQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDO1lBQ3hDLElBQUksV0FBVyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDO1lBQzdFLElBQUksTUFBTSxHQUFHLEtBQUssR0FBRyxXQUFXLENBQUM7WUFDakMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3RyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUE7QUFDTixDQUFDO0FBRUQ7O0dBRUc7QUFDSDtJQUNJLElBQUksT0FBTyxHQUFHLElBQUksZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFN0IsOEVBQThFO0lBQzlFLE9BQU8sQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUk7UUFDbEQsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDcEQsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ25DLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ1QsSUFBSSxDQUFDLGNBQWMsR0FBRyxPQUFPLENBQUM7QUFDbEMsQ0FBQztBQUVEOztHQUVHO0FBQ0gsbUNBQW1DLE1BQWMsRUFBRSxJQUFZO0lBQzNELFNBQVMsQ0FBQyxPQUFPLENBQUM7UUFDZCxPQUFPLEVBQUUsR0FBRztRQUNaLFFBQVEsRUFBRSxHQUFHO0tBQ2hCLENBQUMsQ0FBQztJQUNILGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsTUFBTTtRQUM5RCxTQUFTLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDckMsU0FBUyxDQUFDLE9BQU8sQ0FBQztZQUNkLE9BQU8sRUFBRSxDQUFDO1lBQ1YsUUFBUSxFQUFFLEdBQUc7U0FDaEIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxFQUFFLFVBQVUsS0FBSztRQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVEOztHQUVHO0FBQ0gsdUJBQXVCLEtBQUs7SUFDeEIseUJBQXlCLENBQUMsZUFBZSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRUQ7O0dBRUc7QUFDSDtJQUNJLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxtQkFBMEIsSUFBSTtJQUMxQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUM5QixlQUFlLEVBQUUsQ0FBQztJQUNsQix5QkFBeUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ3ZELENBQUM7QUFKRCw4QkFJQztBQUVEOztHQUVHO0FBQ0g7SUFDSSxlQUFlLEVBQUUsQ0FBQztJQUNsQix5QkFBeUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUM1QyxDQUFDO0FBSEQsZ0NBR0M7QUFFRCxtREFBbUQ7QUFDbkQsbUNBQW1DO0FBQ25DLHVCQUF1QjtBQUN2QixtQkFBbUI7QUFDbkIsc0pBQXNKO0FBQ3RKLHlEQUF5RDtBQUN6RCxpREFBaUQ7QUFDakQsNkRBQTZEO0FBQzdELGVBQWU7QUFDZiwrRUFBK0U7QUFDL0UscUJBQXFCO0FBQ3JCLCtDQUErQztBQUMvQyxlQUFlO0FBQ2YsUUFBUTtBQUNSLElBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlIH0gZnJvbSAndWkvcGFnZSc7XG5pbXBvcnQgeyBXZWJWaWV3IH0gZnJvbSAndWkvd2ViLXZpZXcnO1xuaW1wb3J0IHsgSW1hZ2UgfSBmcm9tICd1aS9pbWFnZSc7XG5pbXBvcnQgeyBHcmlkTGF5b3V0IH0gZnJvbSAndWkvbGF5b3V0cy9ncmlkLWxheW91dCc7XG5cbmltcG9ydCB7IHNjcmVlbiB9IGZyb20gJ3BsYXRmb3JtJztcbmltcG9ydCBvYnNlcnZhYmxlTW9kdWxlID0gcmVxdWlyZShcImRhdGEvb2JzZXJ2YWJsZVwiKTtcbmltcG9ydCB7IHBhdGgsIGtub3duRm9sZGVycyB9IGZyb20gJ2ZpbGUtc3lzdGVtJztcbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgbnNDYW52YXNJbnRlcmZhY2VNb2R1bGUgPSByZXF1aXJlKCduYXRpdmVzY3JpcHQtY2FudmFzLWludGVyZmFjZScpO1xudmFyIG9OU0NhbnZhc0ludGVyZmFjZTtcbnZhciBpbWFnZVZpZXc6IEltYWdlO1xudmFyIHBhZ2U7XG5cbi8qKlxuICogRnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgb24gUGFnZSBMb2FkLiAgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYWdlTG9hZGVkKGFyZ3MpIHtcbiAgICBwYWdlID0gPFBhZ2U+YXJncy5vYmplY3Q7XG4gICAgdmFyIHdlYlZpZXcgPSA8V2ViVmlldz5wYWdlLmdldFZpZXdCeUlkKCd3ZWJWaWV3Jyk7XG4gICAgaW1hZ2VWaWV3ID0gPEltYWdlPnBhZ2UuZ2V0Vmlld0J5SWQoJ2ltZycpO1xuICAgIGluaXRDYW52YXNJbnRlcmZhY2Uod2ViVmlldyk7XG4gICAgc2V0QmluZGluZ0NvbnRleHQoKTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBjYW52YXMgaW50ZXJmYWNlIHBsdWdpbiBhbmQgc2V0cyBpbWFnZSB0byBjYW52YXMsIG9uY2Ugd2VidmlldyBpcyBsb2FkZWQuXG4gKi9cbmZ1bmN0aW9uIGluaXRDYW52YXNJbnRlcmZhY2Uod2ViVmlldzogV2ViVmlldykge1xuICAgIG9OU0NhbnZhc0ludGVyZmFjZSA9IG5ldyBuc0NhbnZhc0ludGVyZmFjZU1vZHVsZS5OYXRpdmVzY3JpcHRDYW52YXNJbnRlcmZhY2Uod2ViVmlldywgJ2NhbnZhc0VsZScpO1xuICAgIHdlYlZpZXcub24oJ2xvYWRGaW5pc2hlZCcsIChhcmdzKSA9PiB7XG4gICAgICAgIGlmICghYXJncy5lcnJvcikge1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzO1xuICAgICAgICAgICAgdmFyIGFzcGVjdFJhdGlvID0gaW1hZ2VWaWV3LmltYWdlU291cmNlLndpZHRoIC8gaW1hZ2VWaWV3LmltYWdlU291cmNlLmhlaWdodDtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB3aWR0aCAvIGFzcGVjdFJhdGlvO1xuICAgICAgICAgICAgb05TQ2FudmFzSW50ZXJmYWNlLnNldEltYWdlKCdzZXRDYW52YXNJbWFnZScsIGltYWdlVmlldy5pbWFnZVNvdXJjZSwgW3sgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9XSk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuXG4vKipcbiAqIFNldHMgUGFnZSBiaW5kaW5nIGNvbnRleHQgZm9yIHR3byB3YXkgZGF0YSBiaW5kaW5nLlxuICovXG5mdW5jdGlvbiBzZXRCaW5kaW5nQ29udGV4dCgpIHtcbiAgICB2YXIgY29udGV4dCA9IG5ldyBvYnNlcnZhYmxlTW9kdWxlLk9ic2VydmFibGUoKTtcbiAgICBjb250ZXh0LnNldCgnYnJpZ2h0bmVzcycsIDApO1xuXG4gICAgLy8gQWRqdXN0aW5nIGltYWdlIGJyaWdodG5lc3MsIG9uY2UgdGhlIGJyaWdodG5lc3Mgc2xpZGVyIHBvc2l0aW9uIGlzIGNoYW5nZWQuXG4gICAgY29udGV4dC5vbigncHJvcGVydHlDaGFuZ2UnLCBfLmRlYm91bmNlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBicmlnaHRuZXNzVmFsdWUgPSBkYXRhLm9iamVjdC5nZXQoJ2JyaWdodG5lc3MnKTtcbiAgICAgICAgc2V0QnJpZ2h0bmVzcyhicmlnaHRuZXNzVmFsdWUpO1xuICAgIH0sIDEwMCkpO1xuICAgIHBhZ2UuYmluZGluZ0NvbnRleHQgPSBjb250ZXh0O1xufVxuXG4vKipcbiAqIFBlcmZvcm1zIGltYWdlIG1hbmlwdWxhdGlvbiBvbiBjYW52YXMgaW4gd2VidmlldywgYW5kIHJlbmRlcnMgdGhlIHJldHVybmVkIGltYWdlIGluIEltYWdlIGVsZW1lbnQuXG4gKi9cbmZ1bmN0aW9uIHBlcmZvcm1DYW52YXNNYWlucHVsYXRpb24oZm5OYW1lOiBzdHJpbmcsIGFyZ3M/OiBhbnlbXSkge1xuICAgIGltYWdlVmlldy5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMC41LFxuICAgICAgICBkdXJhdGlvbjogMTUwXG4gICAgfSk7XG4gICAgb05TQ2FudmFzSW50ZXJmYWNlLmNyZWF0ZUltYWdlKGZuTmFtZSwgYXJncykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGltYWdlVmlldy5pbWFnZVNvdXJjZSA9IHJlc3VsdC5pbWFnZTtcbiAgICAgICAgaW1hZ2VWaWV3LmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxNTBcbiAgICAgICAgfSk7XG4gICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVycm9yKTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBBZGp1c3RzIGJyaWdobmVzcyBvZiB0aGUgaW1hZ2UuXG4gKi9cbmZ1bmN0aW9uIHNldEJyaWdodG5lc3ModmFsdWUpIHtcbiAgICBwZXJmb3JtQ2FudmFzTWFpbnB1bGF0aW9uKCdzZXRCcmlnaHRuZXNzJywgW3ZhbHVlXSk7XG59XG5cbi8qKlxuICogUmVzZXRzIGJyaWdodG5lc3Mgb24gcmVzZXQgaW1hZ2Ugb3BlcmF0aW9uLlxuICovXG5mdW5jdGlvbiByZXNldEJyaWdodG5lc3MoKSB7XG4gICAgcGFnZS5iaW5kaW5nQ29udGV4dC5zZXQoJ2JyaWdodG5lc3MnLCAwKTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIHByZXNldCBzZWxlY3RlZCBieSB1c2VyIHRvIHRoZSBpbWFnZS4gXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRQcmVzZXQoYXJncykge1xuICAgIHZhciBwcmVzZXRJZCA9IGFyZ3Mub2JqZWN0LmlkO1xuICAgIHJlc2V0QnJpZ2h0bmVzcygpO1xuICAgIHBlcmZvcm1DYW52YXNNYWlucHVsYXRpb24oJ3NldFByZXNldCcsIFtwcmVzZXRJZF0pO1xufVxuXG4vKipcbiAqIFJlc2V0cyBpbWFnZSB0byB0aGUgaXRzIGluaXRpYWwgc3RhdGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNldEltYWdlKCkge1xuICAgIHJlc2V0QnJpZ2h0bmVzcygpO1xuICAgIHBlcmZvcm1DYW52YXNNYWlucHVsYXRpb24oJ3Jlc2V0SW1hZ2UnKTtcbn1cblxuLy8gVE9ETzogQWRkIHByb3Zpc2lvbiB0byBkb3dubG9hZCB0aGUgZWRpdGVkIGltYWdlXG4vLyBleHBvcnQgZnVuY3Rpb24gZG93bmxvYWRJbWFnZSgpe1xuLy8gICAgIHZhciBnYWxsYXJ5UGF0aDtcbi8vICAgICBpZihhbmRyb2lkKXtcbi8vICAgICAgICAgZ2FsbGFyeVBhdGggPSBwYXRoLmpvaW4oYW5kcm9pZC5vcy5FbnZpcm9ubWVudC5nZXRFeHRlcm5hbFN0b3JhZ2VEaXJlY3RvcnkoKSsnJywgJycrYW5kcm9pZC5vcy5FbnZpcm9ubWVudC5ESVJFQ1RPUllfUElDVFVSRVMsICdkZW1vLnBuZycpO1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnZ2FsbGFyeSBwYXRoIGlzMSAnLCBnYWxsYXJ5UGF0aCk7XG4vLyAgICAgICAgIHZhciBmb2xkZXIgPSBrbm93bkZvbGRlcnMuZG9jdW1lbnRzKCk7XG4vLyAgICAgICAgIHZhciBmdWxsUGF0aCA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJUZXN0LnBuZ1wiKTtcbi8vICAgICAgICAgdHJ5e1xuLy8gICAgICAgICAgICAgaW1hZ2VWaWV3LmltYWdlU291cmNlLnNhdmVUb0ZpbGUoZnVsbFBhdGgsIEltYWdlRm9ybWF0LnBuZyk7ICAgIFxuLy8gICAgICAgICB9Y2F0Y2goZSl7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgaXMgPT09ICcsIGUpO1xuLy8gICAgICAgICB9ICAgXG4vLyAgICAgfVxuLy8gfSJdfQ==